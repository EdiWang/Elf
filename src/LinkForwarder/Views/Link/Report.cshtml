@section head{
    <link href="~/lib/Chart.js/Chart.min.css" rel="stylesheet" />
    <script src="~/lib/Chart.js/Chart.min.js"></script>
    <script src="~/lib/jquery-dateFormat/jquery.dateFormat.min.js"></script>
}
@section scripts{
    <script>
        $(function () {
            renderReqPastWeekLineChart();
            renderClientTypeChart();
        });

        function renderReqPastWeekLineChart() {
            $.ajax({
                type: "POST",
                url: "/link/tracking-count-past-week",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    const chData = data.item;

                    const trackingDates = [];
                    const requestCounts = [];
                    for (let idx in chData) {
                        if (chData.hasOwnProperty(idx)) {
                            trackingDates.push($.format.date(new Date(chData[idx].trackingDateUtc), "MM/dd/yyyy"));
                            requestCounts.push(parseInt(chData[idx].requestCount));
                        }
                    }

                    var chartData = {
                        labels: trackingDates,
                        datasets: [
                            {
                                label: '# Requests',
                                data: requestCounts,
                                borderColor: '#0072BC',
                                lineTension: 0
                            }]
                    };

                    var pastWeekCounterCtx = document.getElementById('pastweek-counter-canvas');
                    var pastWeekCounterChart = new Chart(pastWeekCounterCtx, {
                        type: 'line',
                        data: chartData,
                        options: {
                            legend: {
                                display: false
                            }
                        }
                    });
                }
            });
        }

        function renderClientTypeChart() {
            $.ajax({
                type: "POST",
                url: "/link/client-type-past-month",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    const ctData = data.item;

                    const clientTypes = [];
                    const clientCounts = [];
                    for (let idx in ctData) {
                        if (ctData.hasOwnProperty(idx)) {
                            clientTypes.push(ctData[idx].clientTypeName);
                            clientCounts.push(parseInt(ctData[idx].count));
                        }
                    }

                    var chartData = {
                        labels: clientTypes,
                        datasets: [
                            {
                                data: clientCounts,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ]
                            }]
                    };

                    var ctCtx = document.getElementById('clienttype-canvas');
                    var ctChart = new Chart(ctCtx, {
                        type: 'doughnut',
                        data: chartData,
                        options: {
                            legend: {
                                display: true,
                                position: 'right'
                            }
                        }
                    });
                }
            });
        }
    </script>
}

<div class="row">
    <div class="col-xl-4 col-lg-6">
        <div class="card">
            <div class="card-body">
                <h6>Request / Past week</h6>
                <div class="pastweek-counter-section">
                    <canvas id="pastweek-counter-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-4 col-lg-6">
        <div class="card">
            <div class="card-body">
                <h6>Client Type / Last month</h6>
                <div class="clienttype-section">
                    <canvas id="clienttype-canvas"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

