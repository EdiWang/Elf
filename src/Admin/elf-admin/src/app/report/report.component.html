<div class="container-fluid">

    <div>
        <mat-form-field>
            <mat-date-range-input [formGroup]="chartDateRange" [rangePicker]="pickerTrackingCount">
                <input matStartDate formControlName="start" placeholder="Start date">
                <input matEndDate formControlName="end" placeholder="End date">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="pickerTrackingCount"></mat-datepicker-toggle>
            <mat-date-range-picker #pickerTrackingCount></mat-date-range-picker>

            <mat-error *ngIf="chartDateRange.controls['start'].hasError('matStartDateInvalid')">Invalid
                start date</mat-error>
            <mat-error *ngIf="chartDateRange.controls['end'].hasError('matEndDateInvalid')">Invalid end
                date</mat-error>
        </mat-form-field>
        <button mat-icon-button color="primary" (click)="getChartData()">
            <mat-icon>refresh</mat-icon>
        </button>
    </div>

    <div class="row g-2">
        <div class="col-sm-6 col-lg-4">
            <mat-card appearance="outlined" class="mb-4">
                <mat-card-header>
                    <mat-card-title>
                        Requests
                    </mat-card-title>
                </mat-card-header>

                <mat-card-content>
                    <div class="chart">
                        <canvas baseChart height="300" [data]="trackingCountChartData"
                            [options]="trackingCountChartOptions" [type]="'line'"></canvas>
                    </div>
                </mat-card-content>
                <mat-card-footer>
                    <mat-progress-bar mode="indeterminate" *ngIf="isTrackingCountLoading"></mat-progress-bar>
                </mat-card-footer>
            </mat-card>
        </div>
        <div class="col-sm-6 col-lg-4">
            <mat-card appearance="outlined" class="mb-4">
                <mat-card-header>
                    <mat-card-title>Client types</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <div class="chart">
                        <canvas baseChart [data]="clientTypeChartData" [options]="clientTypeChartOptions"
                            [type]="'doughnut'"></canvas>
                    </div>
                </mat-card-content>
                <mat-card-footer>
                    <mat-progress-bar mode="indeterminate" *ngIf="isClientTypeLoading"></mat-progress-bar>
                </mat-card-footer>
            </mat-card>
        </div>
        <div class="col-sm-6 col-lg-4">
            <mat-card appearance="outlined" class="mb-4">
                <mat-card-header>
                    <mat-card-title>Most requested links</mat-card-title>
                </mat-card-header>

                <mat-card-content>
                    <div class="chart">
                        <canvas baseChart [data]="mostRequestedChartData" [options]="mostRequestedChartOptions"
                            [type]="'pie'"></canvas>
                    </div>
                </mat-card-content>

                <mat-card-footer>
                    <mat-progress-bar mode="indeterminate" *ngIf="isMostRequestedLinksLoading"></mat-progress-bar>
                </mat-card-footer>
            </mat-card>
        </div>
    </div>

    <kendo-grid [kendoGridBinding]="gridView" kendoGridSelectBy="fwToken" [sortable]="true" [pageable]="true"
        [pageSize]="10">

        <ng-template kendoGridToolbarTemplate>
            <label>Recent Requests</label>
            <kendo-grid-spacer></kendo-grid-spacer>
            <button kendoButton (click)="getRecentRequests()"><i class="bi-arrow-clockwise"></i> Refresh</button>
            <button kendoButton (click)="clearTrackingData()"><i class="bi-arrow-clockwise"></i> Clear</button>
        </ng-template>

        <kendo-grid-column field="fwToken" title="Token" [width]="100">
            <ng-template kendoGridCellTemplate let-dataItem>
                <a href="{{ENV.elfApiBaseUrl}}/fw/{{dataItem.fwToken}}" target="_blank">{{dataItem.fwToken}}</a>
            </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="note" title="Note" [width]="400">
        </kendo-grid-column>

        <kendo-grid-column field="userAgent" title="User Agent">
        </kendo-grid-column>

        <kendo-grid-column field="ipAddress" title="IP Address" [width]="150">
        </kendo-grid-column>

        <kendo-grid-column field="ipCountry" title="Country" [width]="150">
        </kendo-grid-column>

        <kendo-grid-column field="ipRegion" title="Region" [width]="100">
        </kendo-grid-column>

        <kendo-grid-column field="ipCity" title="City" [width]="100">
        </kendo-grid-column>

        <kendo-grid-column field="ipasn" title="ASN" [width]="100">
        </kendo-grid-column>

        <kendo-grid-column field="ipOrg" title="Org" [width]="150">
        </kendo-grid-column>

        <kendo-grid-column field="requestTimeUtc" title="Request Time (UTC)" [width]="180">
            <ng-template kendoGridCellTemplate let-dataItem>
                {{dataItem?.requestTimeUtc | date:'yyyy-MM-dd HH:mm'}}
            </ng-template>
        </kendo-grid-column>
    </kendo-grid>

    <mat-progress-bar mode="indeterminate" *ngIf="isRecentRequestsLoading"></mat-progress-bar>
</div>