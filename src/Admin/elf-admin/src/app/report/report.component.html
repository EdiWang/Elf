<div class="container-fluid">
    <div class="row mt-3 mb-3 g-1">
        <div class="col-auto">
            <kendo-daterange>
                <kendo-dateinput kendoDateRangeStartInput [format]="dateFormat" placeholder="MM/DD/YYYY"
                    [(value)]="range.start"></kendo-dateinput>
                <kendo-dateinput kendoDateRangeEndInput [format]="dateFormat" placeholder="MM/DD/YYYY"
                    [(value)]="range.end"></kendo-dateinput>
                <kendo-daterange-popup [animate]="false">
                </kendo-daterange-popup>
            </kendo-daterange>
        </div>
        <div class="col-auto">
            <button kendoButton (click)="getChartData()">
                <i class="bi-arrow-clockwise"></i>
            </button>
        </div>
    </div>

    <div class="row g-2">
        <div class="col-sm-6 col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    Requests
                    <kendo-loader [type]="'pulsing'" [size]="'medium'" *ngIf="isTrackingCountLoading">
                    </kendo-loader>
                </div>
                <div class="card-body">
                    <kendo-chart style="height:300px">
                        <kendo-chart-series>
                            <kendo-chart-series-item type="line" [data]="linkTrackingDateCount" field="requestCount"
                                categoryField="trackingDateUtc"></kendo-chart-series-item>
                        </kendo-chart-series>
                    </kendo-chart>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    Client types
                    <kendo-loader [type]="'pulsing'" [size]="'medium'" *ngIf="isClientTypeLoading">
                    </kendo-loader>
                </div>
                <div class="card-body">
                    <kendo-chart style="height:300px">
                        <kendo-chart-legend [visible]="false"></kendo-chart-legend>
                        <kendo-chart-series>
                            <kendo-chart-series-item type="donut" [data]="clientTypeCount" field="count"
                                categoryField="clientTypeName">
                                <kendo-chart-series-item-labels [content]="labelContentClientTypeCount"
                                    position="outsideEnd" color="#333">
                                </kendo-chart-series-item-labels>
                            </kendo-chart-series-item>
                        </kendo-chart-series>
                    </kendo-chart>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    Most requested links
                    <kendo-loader [type]="'pulsing'" [size]="'medium'" *ngIf="isMostRequestedLinksLoading">
                    </kendo-loader>
                </div>
                <div class="card-body">
                    <kendo-chart style="height:300px">
                        <kendo-chart-legend [visible]="false"></kendo-chart-legend>
                        <kendo-chart-series>
                            <kendo-chart-series-item type="pie" [data]="mostRequestedLinkCount" field="requestCount"
                                categoryField="note"
                                [labels]="{ visible: true, content: labelContentMostRequestedLinkCount }">
                            </kendo-chart-series-item>
                        </kendo-chart-series>
                    </kendo-chart>
                </div>
            </div>
        </div>
    </div>

    <kendo-grid [kendoGridBinding]="gridView" kendoGridSelectBy="fwToken" [reorderable]="true" [resizable]="true"
        [sortable]="true" [pageable]="true" [pageSize]="5">

        <ng-template kendoGridToolbarTemplate>
            <label>Recent Requests</label>
            <kendo-loader [type]="'pulsing'" [size]="'medium'" *ngIf="isRecentRequestsLoading">
            </kendo-loader>
            <kendo-grid-spacer></kendo-grid-spacer>
            <button kendoButton (click)="getRecentRequests()"><i class="bi-arrow-clockwise"></i> Refresh</button>
            <button kendoButton (click)="clearTrackingData()"><i class="bi-trash"></i> Clear</button>
        </ng-template>

        <kendo-grid-column field="fwToken" title="Token" [width]="100">
            <ng-template kendoGridCellTemplate let-dataItem>
                <a href="{{ENV.elfApiBaseUrl}}/fw/{{dataItem.fwToken}}" target="_blank">{{dataItem.fwToken}}</a>
            </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="note" title="Note" [width]="400">
        </kendo-grid-column>

        <kendo-grid-column field="userAgent" title="User Agent">
            <ng-template kendoGridCellTemplate let-dataItem>
                <div class="crop">{{ dataItem.userAgent }}</div>
            </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="ipAddress" title="IP Address" [width]="150">
        </kendo-grid-column>

        <kendo-grid-column field="ipCountry" title="Country" [width]="150">
        </kendo-grid-column>

        <kendo-grid-column field="ipRegion" title="Region" [width]="150">
            <ng-template kendoGridCellTemplate let-dataItem>
                <div class="crop">{{ dataItem.ipRegion }}</div>
            </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="ipCity" title="City" [width]="100">
        </kendo-grid-column>

        <kendo-grid-column field="ipasn" title="ASN" [width]="100">
        </kendo-grid-column>

        <kendo-grid-column field="ipOrg" title="Org" [width]="150">
            <ng-template kendoGridCellTemplate let-dataItem>
                <div class="crop">{{ dataItem.ipOrg }}</div>
            </ng-template>
        </kendo-grid-column>

        <kendo-grid-column field="requestTimeUtc" title="Request Time (UTC)" [width]="180">
            <ng-template kendoGridCellTemplate let-dataItem>
                {{dataItem?.requestTimeUtc | date:'yyyy-MM-dd HH:mm'}}
            </ng-template>
        </kendo-grid-column>
    </kendo-grid>
</div>